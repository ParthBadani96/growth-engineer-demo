<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinFlow - Working Capital Intelligence | Growth Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: #667eea;
        }
        
        .hero {
            padding: 4rem 0;
            text-align: center;
            color: white;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .cta-section {
            background: white;
            padding: 3rem 0;
            margin: 2rem 0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .demo-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .dashboard {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }
        
        .dashboard.active {
            display: block;
        }
        
        .dashboard h2 {
            color: #333;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .metric-card h3 {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .metric-card p {
            color: #666;
            font-weight: 500;
        }
        
        .leads-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }
        
        .leads-table th, .leads-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }
        
        .leads-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .score-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .score-high {
            background: #d4edda;
            color: #155724;
        }
        
        .score-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .score-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .intent-signals {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .automation-log {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #e3f2fd;
            border-radius: 10px;
        }
        
        .log-entry {
            margin-bottom: 1rem;
            padding: 0.8rem;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }
        
        .timestamp {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.3rem;
        }
        
        .action {
            font-weight: 600;
            color: #333;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }
        
        .close {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .tracking-pixel {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
    </style>
</head>
<body>
    <!-- Tracking pixel for behavioral analytics -->
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="tracking-pixel" id="page-load-tracker">
    
    <header>
        <nav class="container">
            <div class="logo">FinFlow</div>
            <ul class="nav-links">
                <li><a href="#features" onclick="trackEvent('nav_click', 'features')">Features</a></li>
                <li><a href="#pricing" onclick="trackEvent('nav_click', 'pricing')">Pricing</a></li>
                <li><a href="#demo" onclick="trackEvent('nav_click', 'demo')">Demo</a></li>
                <li><a href="#dashboard" onclick="showDashboard()">Analytics</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>AI-Powered Working Capital Intelligence</h1>
                <p>Transform your cash flow management with real-time insights and predictive analytics</p>
            </div>
        </section>

        <section class="cta-section container">
            <div class="demo-form">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">Request Your Personalized Demo</h2>
                <form id="leadForm" onsubmit="handleFormSubmit(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Business Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="company">Company Name *</label>
                        <input type="text" id="company" name="company" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobTitle">Job Title *</label>
                            <input type="text" id="jobTitle" name="jobTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="companySize">Company Size</label>
                            <select id="companySize" name="companySize">
                                <option value="">Select size</option>
                                <option value="1-10">1-10 employees</option>
                                <option value="11-50">11-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-1000">201-1000 employees</option>
                                <option value="1000+">1000+ employees</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="industry">Industry</label>
                        <select id="industry" name="industry">
                            <option value="">Select industry</option>
                            <option value="fintech">FinTech</option>
                            <option value="finance">Finance & Banking</option>
                            <option value="ecommerce">E-commerce</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="technology">Technology</option>
                            <option value="retail">Retail</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn">Request Demo</button>
                </form>
            </div>
        </section>

        <div class="dashboard container" id="dashboard">
            <h2>Growth Engineering Analytics Dashboard</h2>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3 id="totalLeads">0</h3>
                    <p>Total Leads</p>
                </div>
                <div class="metric-card">
                    <h3 id="qualifiedLeads">0</h3>
                    <p>Qualified Leads</p>
                </div>
                <div class="metric-card">
                    <h3 id="conversionRate">0%</h3>
                    <p>Conversion Rate</p>
                </div>
                <div class="metric-card">
                    <h3 id="avgScore">0</h3>
                    <p>Avg Lead Score</p>
                </div>
            </div>

            <div class="intent-signals">
                <h3>Real-Time Intent Signals</h3>
                <div id="intentSignalsList">
                    <p>Monitoring for buying intent signals...</p>
                </div>
            </div>

            <table class="leads-table">
                <thead>
                    <tr>
                        <th>Lead</th>
                        <th>Company</th>
                        <th>Industry</th>
                        <th>Score</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="leadsTableBody">
                    <!-- Dynamic content -->
                </tbody>
            </table>

            <div class="automation-log">
                <h3>Automation Activity Log</h3>
                <div id="automationLog">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>Demo Request Submitted!</h3>
            <div id="leadScoringResult"></div>
            <p>Our team will reach out within 24 hours to schedule your personalized demo.</p>
        </div>
    </div>

    <script>
// HubSpot Configuration - ADD THIS AT THE TOP
const BACKEND_URL = 'https://hubspot-backend-production-2ba5.up.railway.app';

// HubSpot Functions - ADD THESE TOO
async function createHubSpotContact(leadData) {
    try {
        console.log('Sending to backend:', leadData);
        
        const response = await fetch(`${BACKEND_URL}/api/hubspot/contacts`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                leadData: leadData
            })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || `Backend error: ${response.status}`);
        }

        const result = await response.json();
        console.log('Backend success:', result);
        return result.contact;

    } catch (error) {
        console.error('Backend integration error:', error);
        throw error;
    }
}     
        // Global variables for demo
        let leads = [];
        let pageStartTime = Date.now();
        let behavioralData = {
            timeOnPage: 0,
            scrollDepth: 0,
            clickEvents: [],
            formInteractions: 0
        };

        // Initialize tracking
        document.addEventListener('DOMContentLoaded', function() {
            initializeTracking();
            loadExistingLeads();
            startIntentSignalMonitoring();
        });

        function initializeTracking() {
            // Track scroll depth
            window.addEventListener('scroll', function() {
                const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
                behavioralData.scrollDepth = Math.max(behavioralData.scrollDepth, Math.round(scrollPercent));
            });

            // Track form interactions
            const formInputs = document.querySelectorAll('#leadForm input, #leadForm select');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    behavioralData.formInteractions++;
                    trackEvent('form_interaction', input.name);
                });
            });

            // Update time on page every second
            setInterval(function() {
                behavioralData.timeOnPage = Math.round((Date.now() - pageStartTime) / 1000);
            }, 1000);
        }

        function trackEvent(action, category, value = null) {
            const event = {
                timestamp: new Date().toISOString(),
                action: action,
                category: category,
                value: value,
                sessionData: behavioralData
            };
            
            behavioralData.clickEvents.push(event);
            console.log('Event tracked:', event);
            
            // In a real implementation, this would be sent to your analytics platform
            // Example: gtag('event', action, { event_category: category, value: value });
        }

        // ML-powered lead scoring class
class MLLeadScorer {
    constructor() {
        this.model = null;
        this.isModelReady = false;
        this.trainingProgress = 0;
        this.initializeModel();
    }

    async initializeModel() {
        try {
            console.log('Initializing ML model for lead scoring...');
            
            // Generate synthetic training data
            const trainingData = this.generateTrainingData(2000);
            
            // Create neural network model
            this.model = tf.sequential({
                layers: [
                    tf.layers.dense({ inputShape: [8], units: 64, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.3 }),
                    tf.layers.dense({ units: 32, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({ units: 16, activation: 'relu' }),
                    tf.layers.dense({ units: 1, activation: 'sigmoid' })
                ]
            });

            this.model.compile({
                optimizer: tf.train.adam(0.001),
                loss: 'binaryCrossentropy',
                metrics: ['accuracy']
            });

            // Prepare training data
            const { xs, ys } = this.prepareTrainingData(trainingData);
            
            // Train the model with progress updates
            await this.model.fit(xs, ys, {
                epochs: 100,
                batchSize: 32,
                validationSplit: 0.2,
                verbose: 0,
                callbacks: {
                    onEpochEnd: (epoch, logs) => {
                        this.trainingProgress = ((epoch + 1) / 100) * 100;
                        if (epoch % 20 === 0) {
                            console.log(`Training progress: ${this.trainingProgress.toFixed(0)}% - Accuracy: ${(logs.val_acc * 100).toFixed(1)}%`);
                        }
                    }
                }
            });
            
            this.isModelReady = true;
            console.log('ML model training completed!');
            this.updateMLStatus();
            
            // Clean up tensors
            xs.dispose();
            ys.dispose();
            
        } catch (error) {
            console.error('ML model initialization failed:', error);
            this.isModelReady = false;
        }
    }

    generateTrainingData(count) {
        const data = [];
        const industries = ['fintech', 'finance', 'technology', 'healthcare', 'manufacturing', 'retail', 'other'];
        const titles = ['ceo', 'cfo', 'vp', 'director', 'manager', 'analyst', 'specialist', 'associate'];
        const sizes = ['1-10', '11-50', '51-200', '201-1000', '1000+'];
        
        for (let i = 0; i < count; i++) {
            const industry = industries[Math.floor(Math.random() * industries.length)];
            const title = titles[Math.floor(Math.random() * titles.length)];
            const size = sizes[Math.floor(Math.random() * sizes.length)];
            const timeOnPage = Math.random() * 400 + 20;
            const scrollDepth = Math.random() * 100;
            const formInteractions = Math.floor(Math.random() * 25);
            const emailDomain = Math.random() > 0.7 ? 'business' : 'free';
            const visitHour = Math.floor(Math.random() * 24);
            
            // Calculate realistic conversion probability
            let conversionProbability = 0.05; // Base 5%
            
            // Industry scoring
            if (industry === 'fintech') conversionProbability += 0.35;
            else if (industry === 'finance') conversionProbability += 0.25;
            else if (industry === 'technology') conversionProbability += 0.15;
            
            // Title scoring
            if (title === 'ceo' || title === 'cfo') conversionProbability += 0.30;
            else if (title === 'vp' || title === 'director') conversionProbability += 0.20;
            else if (title === 'manager') conversionProbability += 0.10;
            
            // Company size scoring
            if (size === '51-200' || size === '201-1000') conversionProbability += 0.20;
            else if (size === '1000+') conversionProbability += 0.15;
            
            // Behavioral scoring
            if (timeOnPage > 180) conversionProbability += 0.15;
            if (scrollDepth > 75) conversionProbability += 0.10;
            if (formInteractions > 8) conversionProbability += 0.12;
            if (emailDomain === 'business') conversionProbability += 0.08;
            if (visitHour >= 9 && visitHour <= 17) conversionProbability += 0.05;
            
            const converted = Math.random() < Math.min(conversionProbability, 0.85);
            
            data.push({
                industry, title, size, timeOnPage, scrollDepth, 
                formInteractions, emailDomain, visitHour, converted
            });
        }
        
        return data;
    }

    prepareTrainingData(data) {
        const features = data.map(lead => [
            this.encodeIndustry(lead.industry),
            this.encodeTitle(lead.title),
            this.encodeSize(lead.size),
            Math.min(lead.timeOnPage / 400, 1), // Normalize to 0-1
            lead.scrollDepth / 100,
            Math.min(lead.formInteractions / 25, 1),
            lead.emailDomain === 'business' ? 1 : 0,
            this.encodeVisitTime(lead.visitHour)
        ]);
        
        const labels = data.map(lead => lead.converted ? 1 : 0);
        
        return {
            xs: tf.tensor2d(features),
            ys: tf.tensor2d(labels, [labels.length, 1])
        };
    }

    encodeIndustry(industry) {
        const mapping = { 
            'fintech': 1.0, 'finance': 0.8, 'technology': 0.6, 
            'healthcare': 0.4, 'manufacturing': 0.3, 'retail': 0.2, 'other': 0.1 
        };
        return mapping[industry] || 0.1;
    }

    encodeTitle(title) {
        const mapping = { 
            'ceo': 1.0, 'cfo': 0.95, 'vp': 0.7, 'director': 0.6, 
            'manager': 0.4, 'analyst': 0.25, 'specialist': 0.2, 'associate': 0.1 
        };
        return mapping[title] || 0.1;
    }

    encodeSize(size) {
        const mapping = { 
            '1-10': 0.2, '11-50': 0.4, '51-200': 0.9, 
            '201-1000': 1.0, '1000+': 0.75 
        };
        return mapping[size] || 0.1;
    }

    encodeVisitTime(hour) {
        // Business hours get higher score
        if (hour >= 9 && hour <= 17) return 1.0;
        if (hour >= 8 && hour <= 19) return 0.7;
        return 0.3;
    }

    async predictLeadScore(leadData) {
        if (!this.isModelReady) {
            console.log('ML model not ready, using fallback scoring');
            return this.fallbackScore(leadData);
        }

        try {
            const currentHour = new Date().getHours();
            const emailDomain = this.detectEmailDomain(leadData.email);
            
            const features = tf.tensor2d([[
                this.encodeIndustry(leadData.industry || 'other'),
                this.encodeTitle((leadData.jobTitle || '').toLowerCase()),
                this.encodeSize(leadData.companySize || ''),
                Math.min((leadData.sessionData?.timeOnPage || 30) / 400, 1),
                (leadData.sessionData?.scrollDepth || 20) / 100,
                Math.min((leadData.sessionData?.formInteractions || 1) / 25, 1),
                emailDomain === 'business' ? 1 : 0,
                this.encodeVisitTime(currentHour)
            ]]);

            const prediction = await this.model.predict(features);
            const probability = await prediction.data();
            
            features.dispose();
            prediction.dispose();
            
            const score = Math.round(probability[0] * 100);
            
            // Add ML-specific data to lead
            leadData.mlScore = score;
            leadData.mlConfidence = this.calculateConfidence(probability[0]);
            leadData.scoringMethod = 'ML';
            
            return score;
            
        } catch (error) {
            console.error('ML prediction error:', error);
            return this.fallbackScore(leadData);
        }
    }

    detectEmailDomain(email) {
        if (!email) return 'unknown';
        const domain = email.split('@')[1]?.toLowerCase() || '';
        const businessDomains = ['company', 'corp', 'inc', 'ltd', 'llc'];
        const freeDomains = ['gmail', 'yahoo', 'hotmail', 'outlook'];
        
        if (businessDomains.some(bd => domain.includes(bd))) return 'business';
        if (freeDomains.some(fd => domain.includes(fd))) return 'free';
        if (domain.length > 0 && !freeDomains.includes(domain.split('.')[0])) return 'business';
        return 'free';
    }

    calculateConfidence(probability) {
        const distance = Math.abs(probability - 0.5);
        if (distance > 0.4) return 'Very High';
        if (distance > 0.3) return 'High';
        if (distance > 0.2) return 'Medium';
        return 'Low';
    }

    fallbackScore(leadData) {
        let score = 20; // Base score
        
        // Industry scoring
        const industryScores = { 'fintech': 25, 'finance': 20, 'technology': 15 };
        score += industryScores[leadData.industry] || 5;
        
        // Title scoring
        const title = (leadData.jobTitle || '').toLowerCase();
        if (title.includes('cfo') || title.includes('ceo')) score += 25;
        else if (title.includes('director') || title.includes('vp')) score += 15;
        else score += 5;
        
        // Size scoring
        const sizeScores = { '51-200': 20, '201-1000': 25, '1000+': 15 };
        score += sizeScores[leadData.companySize] || 5;
        
        leadData.scoringMethod = 'Fallback';
        return Math.min(100, score);
    }

    updateMLStatus() {
        const indicator = document.createElement('div');
        indicator.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 12px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; z-index: 1000; box-shadow: 0 6px 20px rgba(0,0,0,0.15); animation: slideIn 0.5s ease-out;">
                <span style="margin-right: 8px;">🤖</span>AI Lead Scoring Active
                <div style="font-size: 11px; opacity: 0.9; margin-top: 2px;">Neural Network Trained</div>
            </div>
            <style>
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            </style>
        `;
        document.body.appendChild(indicator);
    }
}

// Initialize ML scorer
const mlScorer = new MLLeadScorer();

// New ML-powered lead scoring function
async function calculateLeadScore(leadData) {
    return await mlScorer.predictLeadScore(leadData);
}
        function calculateBehavioralScore() {
            let score = 0;
            
            // Time on page (higher is better)
            if (behavioralData.timeOnPage > 180) score += 15;
            else if (behavioralData.timeOnPage > 120) score += 10;
            else if (behavioralData.timeOnPage > 60) score += 5;

            // Scroll depth (engaged users scroll more)
            if (behavioralData.scrollDepth > 80) score += 10;
            else if (behavioralData.scrollDepth > 50) score += 5;

            // Form interactions (shows engagement)
            score += Math.min(10, behavioralData.formInteractions * 2);

            return score;
        }

        function calculateIntentScore(leadData) {
            // Simulated intent signals based on company and industry
            let score = 0;
            
            // Companies in target industries show higher intent
            if (leadData.industry === 'fintech' || leadData.industry === 'finance') {
                score += 10;
            }
            
            // Simulate additional intent signals
            if (Math.random() > 0.7) { // 30% chance of high intent signal
                score += 15;
                addIntentSignal(leadData.company, 'High-intent search activity detected');
            }
            
            if (Math.random() > 0.8) { // 20% chance of competitor research
                score += 10;
                addIntentSignal(leadData.company, 'Competitor research detected');
            }

            return score;
        }

        function addIntentSignal(company, signal) {
            const signalElement = document.createElement('div');
            signalElement.innerHTML = `
                <strong>${company}:</strong> ${signal}
                <small style="color: #666; margin-left: 10px;">${new Date().toLocaleTimeString()}</small>
            `;
            signalElement.style.marginBottom = '10px';
            signalElement.style.padding = '8px';
            signalElement.style.background = '#fff3cd';
            signalElement.style.borderRadius = '5px';
            signalElement.style.borderLeft = '3px solid #ffc107';
            
            const container = document.getElementById('intentSignalsList');
            container.insertBefore(signalElement, container.firstChild);
        }

        function enrichLeadData(leadData) {
            // Simulate data enrichment (in real implementation, would use APIs like Clearbit, ZoomInfo, etc.)
            const enrichedData = { ...leadData };
            
            // Simulate company enrichment
            const companyDomains = {
                'generic': '@company.com',
                'fintech': Math.random() > 0.5 ? '@fintech-startup.com' : '@payments-co.com',
                'finance': '@bank-corp.com'
            };
            
            enrichedData.emailDomain = companyDomains[leadData.industry] || '@business.com';
            enrichedData.estimatedRevenue = getEstimatedRevenue(leadData.companySize);
            enrichedData.technographics = getTechnographics(leadData.industry);
            enrichedData.socialPresence = Math.random() > 0.3;
            
            return enrichedData;
        }

        function getEstimatedRevenue(companySize) {
            const revenueRanges = {
                '1-10': '$100K - $1M',
                '11-50': '$1M - $10M',
                '51-200': '$10M - $50M',
                '201-1000': '$50M - $200M',
                '1000+': '$200M+'
            };
            return revenueRanges[companySize] || 'Unknown';
        }

        function getTechnographics(industry) {
            const techStacks = {
                'fintech': ['Stripe', 'Plaid', 'AWS', 'React'],
                'finance': ['Salesforce', 'Oracle', 'Microsoft'],
                'ecommerce': ['Shopify', 'Magento', 'Google Analytics'],
                'technology': ['AWS', 'Docker', 'Kubernetes'],
                'default': ['Microsoft Office', 'Google Workspace']
            };
            return techStacks[industry] || techStacks['default'];
        }

        async function handleFormSubmit(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const leadData = Object.fromEntries(formData.entries());
    
    // Clean session data (remove circular references)
    const cleanSessionData = {
        timeOnPage: behavioralData.timeOnPage,
        scrollDepth: behavioralData.scrollDepth,
        formInteractions: behavioralData.formInteractions,
        clickCount: behavioralData.clickEvents.length
    };
    
    // Add timestamp and session data
    leadData.timestamp = new Date().toISOString();
    leadData.sessionData = cleanSessionData;
    leadData.id = Date.now().toString();
    
    // Show loading state
    const submitBtn = event.target.querySelector('.submit-btn');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Creating Contact...';
    submitBtn.disabled = true;
    
    try {
        // Enrich the lead data
        const enrichedLead = enrichLeadData(leadData);
        
        // Calculate lead score
        const score = await calculateLeadScore(enrichedLead);
        enrichedLead.score = score;
        enrichedLead.qualified = score >= 60;
        enrichedLead.status = getLeadStatus(score);
        
        // Create contact in HubSpot
        try {
            const hubspotContact = await createHubSpotContact(enrichedLead);
            enrichedLead.hubspotContactId = hubspotContact.id;
            
            addAutomationLog(enrichedLead.firstName + ' ' + enrichedLead.lastName, {
                action: `✅ Contact created in HubSpot CRM (ID: ${hubspotContact.id})`,
                priority: 'High',
                timestamp: new Date().toISOString()
            });
            
        } catch (hubspotError) {
            console.warn('HubSpot integration failed:', hubspotError);
            addAutomationLog(enrichedLead.firstName + ' ' + enrichedLead.lastName, {
                action: '⚠️ HubSpot integration failed, saved locally for retry',
                priority: 'Medium',
                timestamp: new Date().toISOString()
            });
        }
        
        // Store lead locally (backup)
        leads.push(enrichedLead);
        localStorage.setItem('demoLeads', JSON.stringify(leads));
        
        // Track conversion
        trackEvent('form_submit', 'demo_request', score);
        
        // Trigger automation
        triggerAutomation(enrichedLead);
        
        // Update dashboard
        updateDashboard();
        
        // Show success modal with scoring details
        showSuccessModal(enrichedLead);
        
        // Reset form
        event.target.reset();
        
    } catch (error) {
        console.error('Form submission error:', error);
        alert('Sorry, there was an error processing your request. Please try again.');
    } finally {
        // Reset button
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}

        function getLeadStatus(score) {
            if (score >= 80) return 'Hot Lead';
            if (score >= 60) return 'Qualified';
            if (score >= 40) return 'Warm';
            return 'Cold';
        }

        function triggerAutomation(lead) {
            const automationActions = [];
            
            // High-score leads get immediate attention
            if (lead.score >= 80) {
                automationActions.push({
                    action: 'Slack notification sent to sales team',
                    priority: 'High',
                    timestamp: new Date().toISOString()
                });
                automationActions.push({
                    action: 'Calendly link sent for immediate booking',
                    priority: 'High',
                    timestamp: new Date().toISOString()
                });
            }
            
            // Qualified leads get standard follow-up
            if (lead.score >= 60) {
                automationActions.push({
                    action: 'Added to high-priority email sequence',
                    priority: 'Medium',
                    timestamp: new Date().toISOString()
                });
                automationActions.push({
                    action: 'CRM contact created with enriched data',
                    priority: 'Medium',
                    timestamp: new Date().toISOString()
                });
            }
            
            // All leads get basic nurturing
            automationActions.push({
                action: 'Welcome email scheduled',
                priority: 'Low',
                timestamp: new Date().toISOString()
            });
            
            // Log automation actions
            automationActions.forEach(action => {
                addAutomationLog(lead.firstName + ' ' + lead.lastName, action);
            });
        }

        function addAutomationLog(leadName, action) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <div class="timestamp">${new Date(action.timestamp).toLocaleString()}</div>
                <div class="action">${leadName}: ${action.action}</div>
            `;
            
            const container = document.getElementById('automationLog');
            container.insertBefore(logEntry, container.firstChild);
        }

        function updateDashboard() {
            const totalLeads = leads.length;
            const qualifiedLeads = leads.filter(lead => lead.qualified).length;
            const conversionRate = totalLeads > 0 ? Math.round((qualifiedLeads / totalLeads) * 100) : 0;
            const avgScore = totalLeads > 0 ? Math.round(leads.reduce((sum, lead) => sum + lead.score, 0) / totalLeads) : 0;
            
            document.getElementById('totalLeads').textContent = totalLeads;
            document.getElementById('qualifiedLeads').textContent = qualifiedLeads;
            document.getElementById('conversionRate').textContent = conversionRate + '%';
            document.getElementById('avgScore').textContent = avgScore;
            
            updateLeadsTable();
        }

        function updateLeadsTable() {
            const tbody = document.getElementById('leadsTableBody');
            tbody.innerHTML = '';
            
            leads.slice(-10).reverse().forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lead.firstName} ${lead.lastName}</td>
                    <td>${lead.company}</td>
                    <td>${lead.industry || 'N/A'}</td>
                    <td><span class="score-badge ${getScoreClass(lead.score)}">${lead.score}</span></td>
                    <td>${lead.status}</td>
                    <td>
                        <button onclick="viewLeadDetails('${lead.id}')" style="padding: 0.3rem 0.8rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            View Details
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getScoreClass(score) {
            if (score >= 70) return 'score-high';
            if (score >= 40) return 'score-medium';
            return 'score-low';
        }

        function viewLeadDetails(leadId) {
            const lead = leads.find(l => l.id === leadId);
            if (lead) {
                const details = `
                    Lead Details for ${lead.firstName} ${lead.lastName}:
                    
                    Company: ${lead.company}
                    Industry: ${lead.industry}
                    Company Size: ${lead.companySize}
                    Job Title: ${lead.jobTitle}
                    Email: ${lead.email}
                    
                    Lead Score: ${lead.score}/100
                    Status: ${lead.status}
                    
                    Behavioral Data:
                    - Time on page: ${lead.sessionData.timeOnPage}s
                    - Scroll depth: ${lead.sessionData.scrollDepth}%
                    - Form interactions: ${lead.sessionData.formInteractions}
                    
                    Enriched Data:
                    - Estimated Revenue: ${lead.estimatedRevenue}
                    - Tech Stack: ${lead.technographics.join(', ')}
                    - Social Presence: ${lead.socialPresence ? 'Yes' : 'No'}
                `;
                alert(details);
            }
        }

        function showSuccessModal(lead) {
            const modal = document.getElementById('successModal');
            const result = document.getElementById('leadScoringResult');
            
            result.innerHTML = `
                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                    <h4>Lead Scoring Results:</h4>
                    <p><strong>Lead Score:</strong> ${lead.score}/100</p>
                    <p><strong>Classification:</strong> ${lead.status}</p>
                    <p><strong>Qualification:</strong> ${lead.qualified ? 'Qualified' : 'Needs Nurturing'}</p>
                    
                    <h5 style="margin-top: 1rem;">Score Breakdown:</h5>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Industry fit: ${calculateTitleScore(lead.jobTitle)} pts</li>
                        <li>Company size: ${getSizeScore(lead.companySize)} pts</li>
                        <li>Job title: ${calculateTitleScore(lead.jobTitle)} pts</li>
                        <li>Behavioral signals: ${calculateBehavioralScore()} pts</li>
                        <li>Intent signals: Variable pts</li>
                    </ul>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function getSizeScore(size) {
            const scores = {
                '1-10': 5, '11-50': 10, '51-200': 20, '201-1000': 25, '1000+': 15
            };
            return scores[size] || 0;
        }

        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
            trackEvent('dashboard_view', 'analytics');
        }

        function loadExistingLeads() {
            const stored = localStorage.getItem('demoLeads');
            if (stored) {
                leads = JSON.parse(stored);
                updateDashboard();
            }
        }

        function startIntentSignalMonitoring() {
            // Simulate real-time intent signals
            setInterval(() => {
                if (Math.random() > 0.95 && leads.length > 0) { // 5% chance every 2 seconds
                    const randomLead = leads[Math.floor(Math.random() * leads.length)];
                    const signals = [
                        'Downloaded pricing guide',
                        'Visited competitor comparison page',
                        'Spent 5+ minutes on ROI calculator',
                        'Shared content on LinkedIn',
                        'Requested product demo from sales'
                    ];
                    const randomSignal = signals[Math.floor(Math.random() * signals.length)];
                    addIntentSignal(randomLead.company, randomSignal);
                }
            }, 2000);
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('successModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>

</html>



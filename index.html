<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinFlow - Working Capital Intelligence | Growth Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: #667eea;
        }
        
        .hero {
            padding: 4rem 0;
            text-align: center;
            color: white;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .cta-section {
            background: white;
            padding: 3rem 0;
            margin: 2rem 0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .demo-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .dashboard {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }
        
        .dashboard.active {
            display: block;
        }
        
        .dashboard h2 {
            color: #333;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .metric-card h3 {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .metric-card p {
            color: #666;
            font-weight: 500;
        }
        
        .leads-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }
        
        .leads-table th, .leads-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }
        
        .leads-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .score-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .score-high {
            background: #d4edda;
            color: #155724;
        }
        
        .score-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .score-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .intent-signals {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .automation-log {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #e3f2fd;
            border-radius: 10px;
        }
        
        .log-entry {
            margin-bottom: 1rem;
            padding: 0.8rem;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }
        
        .timestamp {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.3rem;
        }
        
        .action {
            font-weight: 600;
            color: #333;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }
        
        .close {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* GTM Dashboard Tabs */
        .gtm-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            margin-bottom: 0;
        }

        .gtm-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .gtm-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .gtm-tab-content {
            display: none;
            padding: 2rem;
            background: white;
            border-radius: 0 0 10px 10px;
        }

        .gtm-tab-content.active {
            display: block;
        }

        /* A/B Testing Indicator */
        .ab-test-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
        }

        /* Territory Assignment Alert */
        .territory-alert {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .territory-alert.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .gtm-tabs {
                flex-direction: column;
            }
        }
        
        .tracking-pixel {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
        }

        /* Advanced Analytics Styling */
        .advanced-analytics {
            margin-top: 2rem;
        }

        .analytics-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .analytics-header {
            margin-bottom: 1.5rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .metric-insight {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-complete { background: #28a745; color: white; }
        .status-running { background: #ffc107; color: black; }
        .status-planning { background: #17a2b8; color: white; }

        .industry-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .industry-metric-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        .performance-card {
            text-align: center;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
        }

        .integration-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .integration-card {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid;
        }

        .integration-connected {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .integration-pending {
            border-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }

        .integration-error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- Tracking pixel for behavioral analytics -->
    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="tracking-pixel" id="page-load-tracker">
    
    <!-- A/B Test Indicator -->
    <div class="ab-test-indicator" id="abTestIndicator">
        A/B Test: <span id="testVariant">Loading...</span>
    </div>
    
    <header>
        <nav class="container">
            <div class="logo">FinFlow</div>
            <ul class="nav-links">
                <li><a href="#features" onclick="trackEvent('nav_click', 'features')">Features</a></li>
                <li><a href="#pricing" onclick="trackEvent('nav_click', 'pricing')">Pricing</a></li>
                <li><a href="#demo" onclick="trackEvent('nav_click', 'demo')">Demo</a></li>
                <li><a href="https://autonomous-agent-production.up.railway.app/" onclick="showGTMDashboard()">GTM Analytics</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1 id="heroHeadline">AI-Powered Working Capital Intelligence</h1>
                <p id="heroSubtext">Transform your cash flow management with real-time insights and predictive analytics</p>
            </div>
        </section>

        <section class="cta-section container">
            <div class="demo-form">
                <h2 id="formHeadline" style="text-align: center; margin-bottom: 2rem; color: #333;">Request Your Personalized Demo</h2>
                
                <!-- Territory Assignment Alert -->
                <div class="territory-alert" id="territoryAlert">
                    <strong>Auto-Assigned:</strong> <span id="territoryAssignment"></span>
                </div>
                
                <form id="leadForm" onsubmit="handleFormSubmit(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Business Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="company">Company Name *</label>
                        <input type="text" id="company" name="company" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobTitle">Job Title *</label>
                            <input type="text" id="jobTitle" name="jobTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="companySize">Company Size</label>
                            <select id="companySize" name="companySize" onchange="updateTerritoryAssignment()">
                                <option value="">Select size</option>
                                <option value="1-10">1-10 employees</option>
                                <option value="11-50">11-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-1000">201-1000 employees</option>
                                <option value="1000+">1000+ employees</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="industry">Industry</label>
                        <select id="industry" name="industry">
                            <option value="">Select industry</option>
                            <option value="fintech">FinTech</option>
                            <option value="finance">Finance & Banking</option>
                            <option value="ecommerce">E-commerce</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="technology">Technology</option>
                            <option value="retail">Retail</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn">Request Demo</button>
                </form>
                <div style="margin-top: 40px; padding: 20px; background: #f0f0f0;">
  <h3>What Happens Next?</h3>
  <p>After you submit, watch the magic:</p>
  <ol>
    <li>Check the <a href="https://autonomous-agent-production.up.railway.app/">Autonomous Agent Dashboard</a> - your lead will appear in real-time</li>
    <li>Ask the agent: "Which contacts should I reach out to today?"</li>
    <li>See your contact in HubSpot (if you want access, DM me)</li>
  </ol>
  <p><strong>This entire pipeline is automated. No human intervention.</strong></p>
</div>
            </div>
        </section>

<div class="container">
            <div class="automation-preview" style="margin-top: 30px; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="color: #333; margin-bottom: 15px;">ðŸ”´ Live Automation Activity</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Real-time feed from the autonomous agent monitoring the pipeline</p>
                <div id="liveActivityFeed" style="max-height: 250px; overflow-y: auto; border: 1px solid #e1e1e1; border-radius: 8px; padding: 10px; background: #f8f9fa;">
                    <p style="text-align: center; color: #999;">Loading activity...</p>
                </div>
            </div>
        </div>


        <!-- Enhanced GTM Dashboard -->
        <div class="dashboard container" id="gtmDashboard">
            <h2>Complete GTM Analytics Dashboard</h2>
            
            <!-- GTM Tabs -->
            <div class="gtm-tabs">
                <button class="gtm-tab active" onclick="switchGTMTab('overview')">Overview</button>
                <button class="gtm-tab" onclick="switchGTMTab('campaigns')">Campaigns</button>
                <button class="gtm-tab" onclick="switchGTMTab('analytics')">Analytics</button>
                <button class="gtm-tab" onclick="switchGTMTab('integrations')">Integrations</button>
                <button class="gtm-tab" onclick="switchGTMTab('forecast')">Forecast</button>
            </div>

            <!-- Overview Tab -->
            <div class="gtm-tab-content active" id="overview">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3 id="totalLeads">0</h3>
                        <p>Total Leads</p>
                    </div>
                    <div class="metric-card">
                        <h3 id="qualifiedLeads">0</h3>
                        <p>Qualified Leads</p>
                    </div>
                    <div class="metric-card">
                        <h3 id="conversionRate">0%</h3>
                        <p>Conversion Rate</p>
                    </div>
                    <div class="metric-card">
                        <h3 id="avgScore">0</h3>
                        <p>Avg Lead Score</p>
                    </div>
                    <div class="metric-card">
                        <h3 id="pipelineValue">$0</h3>
                        <p>Pipeline Value</p>
                    </div>
                    <div class="metric-card">
                        <h3 id="forecastAccuracy">0%</h3>
                        <p>Forecast Accuracy</p>
                    </div>
                </div>

                <div class="intent-signals">
                    <h3>Real-Time Intent Signals</h3>
                    <div id="intentSignalsList">
                        <p>Monitoring for buying intent signals...</p>
                    </div>
                </div>

                <table class="leads-table">
                    <thead>
                        <tr>
                            <th>Lead</th>
                            <th>Company</th>
                            <th>Territory</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Deal Value</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>

            <!-- Campaigns Tab -->
            <div class="gtm-tab-content" id="campaigns">
                <div class="advanced-analytics">
                    <div class="analytics-card">
                        <h3 class="analytics-header">A/B Testing Results</h3>
                        
                        <div class="analytics-grid">
                            <div>
                                <h4>Form Conversion Rates</h4>
                                <div class="chart-container">
                                    <canvas id="conversionChart"></canvas>
                                </div>
                                <div class="metric-insight">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span><strong>Winner:</strong> Variant B</span>
                                        <span style="color: #28a745;"><strong>+54% improvement</strong></span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #6c757d;">
                                        Statistical significance: 99.2% | Sample size: 2,847 visitors
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4>Lead Quality Distribution</h4>
                                <div class="chart-container">
                                    <canvas id="leadQualityChart"></canvas>
                                </div>
                                <div class="metric-insight">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span><strong>Avg Score:</strong> 73.2/100</span>
                                        <span style="color: #28a745;"><strong>+18% vs baseline</strong></span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #6c757d;">
                                        High-quality leads: 42% | Target: 35%
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <table style="width: 100%; border-collapse: collapse; background: white; margin-top: 2rem;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Test Name</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Status</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Traffic Split</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Conversion Rate</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Winner</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">Form Headlines</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;"><span class="status-badge status-complete">Complete</span></td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">50/50</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">18.3% vs 11.9%</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">Variant B (+54%)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">CTA Button Color</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;"><span class="status-badge status-running">Running</span></td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">33/33/33</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">15.2% vs 14.8% vs 16.1%</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6;">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="gtm-tab-content" id="analytics">
                <div class="analytics-card">
                    <h3 class="analytics-header">Industry Insights</h3>
                    
                    <div class="industry-metrics">
                        <div class="industry-metric-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">$312B</div>
                            <div style="font-size: 1.1rem; opacity: 0.9;">Global FinTech Market</div>
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">26.5% CAGR (2023-2030)</div>
                        </div>
                        
                        <div class="industry-metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">$847K</div>
                            <div style="font-size: 1.1rem; opacity: 0.9;">Avg Deal Size</div>
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">B2B FinTech Solutions</div>
                        </div>
                        
                        <div class="industry-metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">3.2%</div>
                            <div style="font-size: 1.1rem; opacity: 0.9;">Industry Conversion</div>
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">Demo â†’ Paid Customer</div>
                        </div>
                    </div>
                    
                    <div class="analytics-grid">
                        <div>
                            <h4>Lead Scoring by Industry</h4>
                            <div class="chart-container">
                                <canvas id="industryChart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h4>Deal Velocity Trends</h4>
                            <div class="chart-container">
                                <canvas id="dealVelocityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="analytics-header">Real-Time Performance Metrics</h3>
                    
                    <div class="performance-grid">
                        <div class="performance-card">
                            <div style="font-size: 2rem; font-weight: bold; color: #28a745;" id="liveConversion">18.3%</div>
                            <div style="color: #6c757d; margin-top: 0.5rem;">Conversion Rate</div>
                            <div style="font-size: 0.8rem; color: #28a745; margin-top: 0.25rem;">â†— +2.1% vs last week</div>
                        </div>
                        
                        <div class="performance-card">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc3545;" id="avgScoreLive">73.2</div>
                            <div style="color: #6c757d; margin-top: 0.5rem;">Avg Lead Score</div>
                            <div style="font-size: 0.8rem; color: #28a745; margin-top: 0.25rem;">â†— +5.8% vs baseline</div>
                        </div>
                        
                        <div class="performance-card">
                            <div style="font-size: 2rem; font-weight: bold; color: #fd7e14;" id="responseTime">1.3s</div>
                            <div style="color: #6c757d; margin-top: 0.5rem;">Avg Response Time</div>
                            <div style="font-size: 0.8rem; color: #28a745; margin-top: 0.25rem;">â†— -0.2s improvement</div>
                        </div>
                        
                        <div class="performance-card">
                            <div style="font-size: 2rem; font-weight: bold; color: #6f42c1;" id="qualifiedLeadsLive">42%</div>
                            <div style="color: #6c757d; margin-top: 0.5rem;">Qualified Rate</div>
                            <div style="font-size: 0.8rem; color: #28a745; margin-top: 0.25rem;">â†— +7% vs target</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations Tab -->
            <div class="gtm-tab-content" id="integrations">
                <div class="analytics-card">
                    <h3 class="analytics-header">Integration Health Monitor</h3>
                    
                    <div class="integration-status">
                        <div class="integration-card integration-connected">
                            <h4>HubSpot CRM</h4>
                            <p>Connected</p>
                            <small>Last sync: 2 min ago</small>
                        </div>
                        
                        <div class="integration-card integration-connected">
                            <h4>Clay Enrichment</h4>
                            <p>Connected</p>
                            <small>Credits: 847 remaining</small>
                        </div>
                        
                        <div class="integration-card integration-connected">
                            <h4>Slack Notifications</h4>
                            <p>Connected</p>
                            <small>Channel: #sales-alerts</small>
                        </div>
                        
                        <div class="integration-card integration-pending">
                            <h4>Asana Projects</h4>
                            <p>Pending Setup</p>
                            <small>Configure API key</small>
                        </div>
                        
                        <div class="integration-card integration-pending">
                            <h4>Zendesk Support</h4>
                            <p>Pending Setup</p>
                            <small>Awaiting credentials</small>
                        </div>
                        
                        <div class="integration-card integration-error">
                            <h4>DealHub CPQ</h4>
                            <p>Connection Error</p>
                            <small>Check API status</small>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <h4>Data Flow Monitor</h4>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <span>Lead Capture â†’ Clay Enrichment</span>
                                <span style="color: #28a745; font-weight: bold;">âœ“ Active</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <span>Clay â†’ HubSpot Sync</span>
                                <span style="color: #28a745; font-weight: bold;">âœ“ Active</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <span>Territory Assignment</span>
                                <span style="color: #28a745; font-weight: bold;">âœ“ Active</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Slack Notifications</span>
                                <span style="color: #28a745; font-weight: bold;">âœ“ Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Forecast Tab -->
            <div class="gtm-tab-content" id="forecast">
                <div class="analytics-card">
                    <h3 class="analytics-header">Revenue Forecasting</h3>
                    
                    <div class="analytics-grid">
                        <div>
                            <h4>Pipeline Forecast</h4>
                            <div class="chart-container">
                                <canvas id="pipelineForecastChart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h4>Territory Performance</h4>
                            <div class="chart-container">
                                <canvas id="territoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <h4>AI-Powered Predictions</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1rem;">
                            <div style="padding: 1.5rem; background: #e8f5e8; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #28a745;">$2.4M</div>
                                <div style="color: #155724; margin-top: 0.5rem;">Q4 Forecast</div>
                                <div style="font-size: 0.9rem; color: #6c757d; margin-top: 0.25rem;">87% confidence</div>
                            </div>
                            
                            <div style="padding: 1.5rem; background: #fff3cd; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #856404;">67 days</div>
                                <div style="color: #856404; margin-top: 0.5rem;">Avg Sales Cycle</div>
                                <div style="font-size: 0.9rem; color: #6c757d; margin-top: 0.25rem;">-8% vs last quarter</div>
                            </div>
                            
                            <div style="padding: 1.5rem; background: #e3f2fd; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #1976d2;">73%</div>
                                <div style="color: #1976d2; margin-top: 0.5rem;">Win Rate</div>
                                <div style="font-size: 0.9rem; color: #6c757d; margin-top: 0.25rem;">+5% improvement</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="automation-log">
                    <h3>GTM Automation Activity Log</h3>
                    <div id="automationLog">
                        <!-- Dynamic content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>Demo Request Submitted!</h3>
            <div id="leadScoringResult"></div>
            <p>Our team will reach out within 24 hours to schedule your personalized demo.</p>
        </div>
    </div>

    <script>
        // Global Configuration
        const BACKEND_URL = 'https://hubspot-backend-production-2ba5.up.railway.app';
        
        // Global variables
        let leads = [];
        let pageStartTime = Date.now();
        let currentABVariant = 'A';
        let analyticsCharts = {};
        let behavioralData = {
            timeOnPage: 0,
            scrollDepth: 0,
            clickEvents: [],
            formInteractions: 0
        };

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeABTesting();
            initializeTracking();
            loadExistingLeads();
            startIntentSignalMonitoring();
            initializeMLScorer();
            updateGTMDashboard();
        });

        // A/B Testing Implementation
        function initializeABTesting() {
            // Get or set A/B test variant
            let variant = localStorage.getItem('abTestVariant');
            if (!variant) {
                variant = Math.random() < 0.5 ? 'A' : 'B';
                localStorage.setItem('abTestVariant', variant);
            }
            currentABVariant = variant;
            
            // Update UI based on variant
            const indicator = document.getElementById('abTestIndicator');
if (indicator) {
    indicator.querySelector('#testVariant').textContent = `Variant ${variant}`;
}
            const heroHeadline = document.getElementById('heroHeadline');
            const formHeadline = document.getElementById('formHeadline');
            const submitBtn = document.getElementById('submitBtn');
            
            if (variant === 'B') {
                heroHeadline.textContent = 'Revolutionary AI-Powered Working Capital Intelligence';
                formHeadline.textContent = 'Get Your FREE Personalized Demo Today';
                submitBtn.textContent = 'Get Free Demo Now';
                if (indicator) {
        indicator.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
    }
        }                
            
            // Track variant assignment
            trackEvent('ab_test_assigned', `variant_${variant}`);
        }

        // Territory Assignment
        function updateTerritoryAssignment() {
            const companySize = document.getElementById('companySize').value;
            const territoryAlert = document.getElementById('territoryAlert');
            const territoryAssignment = document.getElementById('territoryAssignment');
            
            if (companySize) {
                let territory = 'SMB Team';
                let rep = 'Sarah Johnson';
                
                if (companySize === '201-1000' || companySize === '1000+') {
                    territory = 'Enterprise Team';
                    rep = 'Michael Chen';
                } else if (companySize === '51-200') {
                    territory = 'Mid-Market Team';
                    rep = 'Alex Rodriguez';
                }
                
                territoryAssignment.textContent = `${territory} - ${rep}`;
                territoryAlert.classList.add('show');
                
                trackEvent('territory_assigned', territory);
            } else {
                territoryAlert.classList.remove('show');
            }
        }

        // Enhanced Form Submission with GTM Integration
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const leadData = Object.fromEntries(formData.entries());
            
            // Add GTM-specific data
            leadData.timestamp = new Date().toISOString();
            leadData.id = Date.now().toString();
            leadData.abVariant = currentABVariant;
            leadData.sessionData = {
                timeOnPage: behavioralData.timeOnPage,
                scrollDepth: behavioralData.scrollDepth,
                formInteractions: behavioralData.formInteractions,
                clickCount: behavioralData.clickEvents.length
            };
            
            // Territory assignment
            const territoryText = document.getElementById('territoryAssignment').textContent;
            if (territoryText) {
                const [territory, rep] = territoryText.split(' - ');
                leadData.territory = territory;
                leadData.assignedRep = rep;
            }
            
            // Show loading state
            const submitBtn = event.target.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;
            
            try {
                // Calculate lead score
                const score = await calculateLeadScore(leadData);
                leadData.score = score;
                leadData.qualified = score >= 60;
                leadData.status = getLeadStatus(score);
                
                // Calculate forecasted deal value
                leadData.forecastedDealValue = calculateDealValue(leadData);
                
                // Create contact in backend (HubSpot + Clay + Slack)
                try {
                    const response = await fetch(`${BACKEND_URL}/api/hubspot/contacts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ leadData })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        leadData.hubspotContactId = result.contact?.id;
                        
                        // Merge enrichment data
                        if (result.enrichmentData) {
                            Object.assign(leadData, result.enrichmentData);
                        }
                        
                        addAutomationLog(leadData.firstName + ' ' + leadData.lastName, {
                            action: `âœ… Contact created in HubSpot CRM`,
                            priority: 'High',
                            timestamp: new Date().toISOString()
                        });
                        
                        if (result.slackNotified) {
                            addAutomationLog(leadData.firstName + ' ' + leadData.lastName, {
                                action: 'ðŸ“± High-value lead alert sent to Slack',
                                priority: 'High',
                                timestamp: new Date().toISOString()
                            });
                        }
                    }
                } catch (error) {
                    console.warn('Backend integration failed:', error);
                    addAutomationLog(leadData.firstName + ' ' + leadData.lastName, {
                        action: 'âš ï¸ Backend integration failed, saved locally',
                        priority: 'Medium',
                        timestamp: new Date().toISOString()
                    });
                }
                
                // Store lead locally
                leads.push(leadData);
                localStorage.setItem('demoLeads', JSON.stringify(leads));
                
                // Track conversion
                trackEvent('form_submit', `variant_${currentABVariant}`, score);
                
                // Trigger GTM automation
                triggerGTMAutomation(leadData);
                
                // Update dashboard
                updateGTMDashboard();
                
                // Show success modal
                showSuccessModal(leadData);
                
                // Reset form
                event.target.reset();
                document.getElementById('territoryAlert').classList.remove('show');
                
            } catch (error) {
                console.error('Form submission error:', error);
                alert('Sorry, there was an error. Please try again.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // GTM Dashboard Functions
        function showGTMDashboard() {
            document.getElementById('gtmDashboard').classList.add('active');
            document.getElementById('gtmDashboard').scrollIntoView({ behavior: 'smooth' });
            trackEvent('dashboard_view', 'gtm_analytics');
            
            // Initialize charts if not already done
            setTimeout(() => {
                if (!analyticsCharts.initialized) {
                    initializeAllCharts();
                    analyticsCharts.initialized = true;
                }
            }, 500);
        }

        function switchGTMTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.gtm-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.gtm-tab-content').forEach(content => content.classList.remove('active'));
            
            // Show selected tab
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            trackEvent('tab_switch', tabName);
        }

        function updateGTMDashboard() {
            const totalLeads = leads.length;
            const qualifiedLeads = leads.filter(lead => lead.qualified).length;
            const conversionRate = totalLeads > 0 ? Math.round((qualifiedLeads / totalLeads) * 100) : 0;
            const avgScore = totalLeads > 0 ? Math.round(leads.reduce((sum, lead) => sum + lead.score, 0) / totalLeads) : 0;
            const pipelineValue = leads.reduce((sum, lead) => sum + (lead.forecastedDealValue || 0), 0);
            
            // Update metrics
            document.getElementById('totalLeads').textContent = totalLeads;
            document.getElementById('qualifiedLeads').textContent = qualifiedLeads;
            document.getElementById('conversionRate').textContent = conversionRate + '%';
            document.getElementById('avgScore').textContent = avgScore;
            document.getElementById('pipelineValue').textContent = '$' + (pipelineValue / 1000).toFixed(0) + 'K';
            document.getElementById('forecastAccuracy').textContent = '87%';
            
            updateLeadsTable();
        }

        function updateLeadsTable() {
            const tbody = document.getElementById('leadsTableBody');
            tbody.innerHTML = '';
            
            leads.slice(-10).reverse().forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lead.firstName} ${lead.lastName}</td>
                    <td>${lead.company}</td>
                    <td>${lead.territory || 'Auto-Assigned'}</td>
                    <td><span class="score-badge ${getScoreClass(lead.score)}">${lead.score}</span></td>
                    <td>${lead.status}</td>
                    <td>${((lead.forecastedDealValue || 0) / 1000).toFixed(0)}K</td>
                    <td>
                        <button onclick="viewLeadDetails('${lead.id}')" style="padding: 0.3rem 0.8rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">
                            View Details
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ML Lead Scoring (Enhanced)
        class MLLeadScorer {
            constructor() {
                this.model = null;
                this.isModelReady = false;
                this.initializeModel();
            }

            async initializeModel() {
                try {
                    console.log('Initializing GTM ML model...');
                    
                    const trainingData = this.generateTrainingData(2000);
                    
                    this.model = tf.sequential({
                        layers: [
                            tf.layers.dense({ inputShape: [10], units: 128, activation: 'relu' }),
                            tf.layers.dropout({ rate: 0.3 }),
                            tf.layers.dense({ units: 64, activation: 'relu' }),
                            tf.layers.dropout({ rate: 0.2 }),
                            tf.layers.dense({ units: 32, activation: 'relu' }),
                            tf.layers.dense({ units: 1, activation: 'sigmoid' })
                        ]
                    });

                    this.model.compile({
                        optimizer: tf.train.adam(0.001),
                        loss: 'binaryCrossentropy',
                        metrics: ['accuracy']
                    });

                    const { xs, ys } = this.prepareTrainingData(trainingData);
                    
                    await this.model.fit(xs, ys, {
                        epochs: 100,
                        batchSize: 32,
                        validationSplit: 0.2,
                        verbose: 0
                    });
                    
                    this.isModelReady = true;
                    console.log('GTM ML model ready!');
                    
                    xs.dispose();
                    ys.dispose();
                    
                } catch (error) {
                    console.error('ML model failed:', error);
                    this.isModelReady = false;
                }
            }

            generateTrainingData(count) {
                const data = [];
                const industries = ['fintech', 'finance', 'technology', 'healthcare', 'manufacturing', 'retail'];
                const titles = ['ceo', 'cfo', 'vp', 'director', 'manager', 'analyst'];
                const sizes = ['1-10', '11-50', '51-200', '201-1000', '1000+'];
                
                for (let i = 0; i < count; i++) {
                    const industry = industries[Math.floor(Math.random() * industries.length)];
                    const title = titles[Math.floor(Math.random() * titles.length)];
                    const size = sizes[Math.floor(Math.random() * sizes.length)];
                    const timeOnPage = Math.random() * 400 + 20;
                    const scrollDepth = Math.random() * 100;
                    const formInteractions = Math.floor(Math.random() * 25);
                    const emailDomain = Math.random() > 0.7 ? 'business' : 'free';
                    const visitHour = Math.floor(Math.random() * 24);
                    const abVariant = Math.random() > 0.5 ? 'B' : 'A';
                    const hasTerritory = Math.random() > 0.3;
                    
                    let conversionProbability = 0.05;
                    
                    // Enhanced scoring factors
                    if (industry === 'fintech') conversionProbability += 0.35;
                    if (title === 'ceo' || title === 'cfo') conversionProbability += 0.30;
                    if (size === '51-200' || size === '201-1000') conversionProbability += 0.20;
                    if (timeOnPage > 180) conversionProbability += 0.15;
                    if (abVariant === 'B') conversionProbability += 0.10;
                    if (hasTerritory) conversionProbability += 0.08;
                    
                    const converted = Math.random() < Math.min(conversionProbability, 0.85);
                    
                    data.push({
                        industry, title, size, timeOnPage, scrollDepth, 
                        formInteractions, emailDomain, visitHour, abVariant, hasTerritory, converted
                    });
                }
                
                return data;
            }

            prepareTrainingData(data) {
                const features = data.map(lead => [
                    this.encodeIndustry(lead.industry),
                    this.encodeTitle(lead.title),
                    this.encodeSize(lead.size),
                    Math.min(lead.timeOnPage / 400, 1),
                    lead.scrollDepth / 100,
                    Math.min(lead.formInteractions / 25, 1),
                    lead.emailDomain === 'business' ? 1 : 0,
                    this.encodeVisitTime(lead.visitHour),
                    lead.abVariant === 'B' ? 1 : 0,
                    lead.hasTerritory ? 1 : 0
                ]);
                
                const labels = data.map(lead => lead.converted ? 1 : 0);
                
                return {
                    xs: tf.tensor2d(features),
                    ys: tf.tensor2d(labels, [labels.length, 1])
                };
            }

            encodeIndustry(industry) {
                const mapping = { 
                    'fintech': 1.0, 'finance': 0.8, 'technology': 0.6, 
                    'healthcare': 0.4, 'manufacturing': 0.3, 'retail': 0.2 
                };
                return mapping[industry] || 0.1;
            }

            encodeTitle(title) {
                const mapping = { 
                    'ceo': 1.0, 'cfo': 0.95, 'vp': 0.7, 'director': 0.6, 
                    'manager': 0.4, 'analyst': 0.2 
                };
                return mapping[title] || 0.1;
            }

            encodeSize(size) {
                const mapping = { 
                    '1-10': 0.2, '11-50': 0.4, '51-200': 0.9, 
                    '201-1000': 1.0, '1000+': 0.75 
                };
                return mapping[size] || 0.1;
            }

            encodeVisitTime(hour) {
                if (hour >= 9 && hour <= 17) return 1.0;
                if (hour >= 8 && hour <= 19) return 0.7;
                return 0.3;
            }

            async predictLeadScore(leadData) {
                if (!this.isModelReady) {
                    return this.fallbackScore(leadData);
                }

                try {
                    const currentHour = new Date().getHours();
                    const emailDomain = this.detectEmailDomain(leadData.email);
                    
                    const features = tf.tensor2d([[
                        this.encodeIndustry(leadData.industry || 'other'),
                        this.encodeTitle((leadData.jobTitle || '').toLowerCase()),
                        this.encodeSize(leadData.companySize || ''),
                        Math.min((leadData.sessionData?.timeOnPage || 30) / 400, 1),
                        (leadData.sessionData?.scrollDepth || 20) / 100,
                        Math.min((leadData.sessionData?.formInteractions || 1) / 25, 1),
                        emailDomain === 'business' ? 1 : 0,
                        this.encodeVisitTime(currentHour),
                        leadData.abVariant === 'B' ? 1 : 0,
                        leadData.territory ? 1 : 0
                    ]]);

                    const prediction = await this.model.predict(features);
                    const probability = await prediction.data();
                    
                    features.dispose();
                    prediction.dispose();
                    
                    const score = Math.round(probability[0] * 100);
                    
                    leadData.mlScore = score;
                    leadData.mlConfidence = this.calculateConfidence(probability[0]);
                    leadData.scoringMethod = 'Enhanced GTM ML';
                    
                    return score;
                    
                } catch (error) {
                    console.error('ML prediction error:', error);
                    return this.fallbackScore(leadData);
                }
            }

            detectEmailDomain(email) {
                if (!email) return 'unknown';
                const domain = email.split('@')[1]?.toLowerCase() || '';
                const freeDomains = ['gmail', 'yahoo', 'hotmail', 'outlook'];
                
                if (freeDomains.some(fd => domain.includes(fd))) return 'free';
                return 'business';
            }

            calculateConfidence(probability) {
                const distance = Math.abs(probability - 0.5);
                if (distance > 0.4) return 'Very High';
                if (distance > 0.3) return 'High';
                if (distance > 0.2) return 'Medium';
                return 'Low';
            }

            fallbackScore(leadData) {
                let score = 20;
                
                const industryScores = { 'fintech': 25, 'finance': 20, 'technology': 15 };
                score += industryScores[leadData.industry] || 5;
                
                const title = (leadData.jobTitle || '').toLowerCase();
                if (title.includes('cfo') || title.includes('ceo')) score += 25;
                else if (title.includes('director') || title.includes('vp')) score += 15;
                
                const sizeScores = { '51-200': 20, '201-1000': 25, '1000+': 15 };
                score += sizeScores[leadData.companySize] || 5;
                
                if (leadData.abVariant === 'B') score += 10;
                if (leadData.territory) score += 8;
                
                leadData.scoringMethod = 'Enhanced Fallback';
                return Math.min(100, score);
            }
        }

        // Initialize ML Scorer
        const mlScorer = new MLLeadScorer();

        async function calculateLeadScore(leadData) {
            return await mlScorer.predictLeadScore(leadData);
        }

        function calculateDealValue(leadData) {
    let baseValue = 15000; // $15K base (more realistic)
    
    // Industry multipliers (reduced)
    const industryMultipliers = {
        'fintech': 1.8,
        'finance': 2.0,
        'technology': 1.5,
        'healthcare': 1.4,
        'manufacturing': 1.2,
        'retail': 1.0
    };
    
    // Size multipliers (more realistic)
    const sizeMultipliers = {
        '1-10': 0.3,
        '11-50': 0.8,
        '51-200': 1.5,
        '201-1000': 2.5,
        '1000+': 3.5
    };
    
    const industryMult = industryMultipliers[leadData.industry] || 1.0;
    const sizeMult = sizeMultipliers[leadData.companySize] || 1.0;
    const scoreMult = (leadData.score / 100) * 1.2; // Reduced influence
    
    return Math.round(baseValue * industryMult * sizeMult * scoreMult);
}
        function getLeadStatus(score) {
            if (score >= 80) return 'Hot Lead';
            if (score >= 60) return 'Qualified';
            if (score >= 40) return 'Warm';
            return 'Cold';
        }

        function getScoreClass(score) {
            if (score >= 70) return 'score-high';
            if (score >= 40) return 'score-medium';
            return 'score-low';
        }

        // GTM Automation
        function triggerGTMAutomation(lead) {
            const automationActions = [];
            
            if (lead.score >= 80) {
                automationActions.push({
                    action: 'ðŸš¨ Instant Slack alert to enterprise team',
                    priority: 'Critical',
                    timestamp: new Date().toISOString()
                });
                automationActions.push({
                    action: 'ðŸ“ž Auto-book executive briefing call',
                    priority: 'High',
                    timestamp: new Date().toISOString()
                });
            }
            
            if (lead.score >= 60) {
                automationActions.push({
                    action: 'ðŸŽ¯ Added to high-priority nurture sequence',
                    priority: 'Medium',
                    timestamp: new Date().toISOString()
                });
                automationActions.push({
                    action: 'ðŸ“Š Deal created in HubSpot with forecast',
                    priority: 'Medium',
                    timestamp: new Date().toISOString()
                });
            }

            automationActions.push({
                action: 'ðŸ“§ Welcome email sequence initiated',
                priority: 'Low',
                timestamp: new Date().toISOString()
            });
            
            // Log automation actions
            automationActions.forEach(action => {
                addAutomationLog(lead.firstName + ' ' + lead.lastName, action);
            });
        }

        function addAutomationLog(leadName, action) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <div class="timestamp">${new Date(action.timestamp).toLocaleString()}</div>
                <div class="action">${leadName}: ${action.action}</div>
            `;
            
            const container = document.getElementById('automationLog');
            container.insertBefore(logEntry, container.firstChild);
        }

        function viewLeadDetails(leadId) {
            const lead = leads.find(l => l.id === leadId);
            if (lead) {
                alert(`Lead Details for ${lead.firstName} ${lead.lastName}:
                
Company: ${lead.company}
Industry: ${lead.industry}
Territory: ${lead.territory || 'Not assigned'}
Score: ${lead.score}/100
Status: ${lead.status}
Deal Value: $${((lead.forecastedDealValue || 0) / 1000).toFixed(0)}K

ML Analysis:
- Scoring Method: ${lead.scoringMethod}
- Confidence: ${lead.mlConfidence || 'High'}
- A/B Variant: ${lead.abVariant}

Session Data:
- Time on page: ${lead.sessionData?.timeOnPage || 0}s
- Scroll depth: ${lead.sessionData?.scrollDepth || 0}%
- Form interactions: ${lead.sessionData?.formInteractions || 0}`);
            }
        }

        function showSuccessModal(lead) {
    const modal = document.getElementById('successModal');
    const result = document.getElementById('leadScoringResult');
    
    result.innerHTML = `
        <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <h4>AI-Powered Lead Scoring Results:</h4>
            <p><strong>ML Score:</strong> ${lead.score}/100</p>
            <p><strong>Status:</strong> ${lead.status}</p>
            <p><strong>Forecasted Deal Value:</strong> $${((lead.forecastedDealValue || 0) / 1000).toFixed(0)}K</p>
            <p><strong>Territory:</strong> ${lead.territory || 'Auto-assigned'}</p>
            
            <h5 style="margin-top: 1rem;">How We Scored You:</h5>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                Our ML model analyzes 10 factors:
                <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                    <li><strong>Industry fit:</strong> ${lead.industry || 'N/A'} (FinTech scores highest)</li>
                    <li><strong>Seniority:</strong> ${lead.jobTitle || 'N/A'} (C-level = higher score)</li>
                    <li><strong>Company size:</strong> ${lead.companySize || 'N/A'} (mid-market ideal)</li>
                    <li><strong>Engagement:</strong> ${lead.sessionData?.timeOnPage || 0}s on page, ${lead.sessionData?.scrollDepth || 0}% scrolled</li>
                    <li><strong>Email domain:</strong> Business vs personal</li>
                    <li><strong>Visit timing:</strong> Business hours = higher intent</li>
                </ul>
                Model confidence: ${lead.mlConfidence || 'High'}
            </div>
        </div>
    `;
    
    modal.style.display = 'block';
}

        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        // Initialize All Charts
        function initializeAllCharts() {
            initializeConversionChart();
            initializeLeadQualityChart();
            initializeIndustryChart();
            initializeDealVelocityChart();
            initializePipelineForecastChart();
            initializeTerritoryChart();
            startRealTimeMetrics();
        }

        function initializeConversionChart() {
    const ctx = document.getElementById('conversionChart');
    if (!ctx || analyticsCharts.conversion) return; 

    analyticsCharts.conversion = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Control (A)', 'Variant B'],
                    datasets: [{
                        label: 'Conversion Rate (%)',
                        data: [11.9, 18.3],
                        backgroundColor: [
                            'rgba(108, 117, 125, 0.8)',
                            'rgba(40, 167, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgba(108, 117, 125, 1)',
                            'rgba(40, 167, 69, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 20,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeLeadQualityChart() {
            const ctx = document.getElementById('leadQualityChart');
            if (!ctx) return;

            analyticsCharts.leadQuality = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Hot (80-100)', 'Qualified (60-79)', 'Warm (40-59)', 'Cold (0-39)'],
                    datasets: [{
                        data: [28, 42, 23, 7],
                        backgroundColor: [
                            'rgba(220, 53, 69, 0.8)',
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(108, 117, 125, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function initializeIndustryChart() {
            const ctx = document.getElementById('industryChart');
            if (!ctx) return;

            analyticsCharts.industry = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Conversion', 'Deal Size', 'Sales Cycle', 'Lead Quality', 'Market Size'],
                    datasets: [{
                        label: 'FinTech',
                        data: [95, 88, 72, 91, 85],
                        borderColor: 'rgba(40, 167, 69, 1)',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 2
                    }, {
                        label: 'Finance',
                        data: [78, 92, 45, 83, 95],
                        borderColor: 'rgba(255, 193, 7, 1)',
                        backgroundColor: 'rgba(255, 193, 7, 0.2)',
                        pointBackgroundColor: 'rgba(255, 193, 7, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function initializeDealVelocityChart() {
            const ctx = document.getElementById('dealVelocityChart');
            if (!ctx) return;

            analyticsCharts.dealVelocity = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [{
                        label: 'Deal Velocity (Days)',
                        data: [89, 82, 76, 71, 68, 65, 67, 63, 61],
                        borderColor: 'rgba(111, 66, 193, 1)',
                        backgroundColor: 'rgba(111, 66, 193, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 100
                        }
                    }
                }
            });
        }

        function initializePipelineForecastChart() {
            const ctx = document.getElementById('pipelineForecastChart');
            if (!ctx) return;

            analyticsCharts.pipelineForecast = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar'],
                    datasets: [{
                        label: 'Forecast',
                        data: [1200, 1450, 1800, 2200, 2100, 2400],
                        borderColor: 'rgba(40, 167, 69, 1)',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 3,
                        fill: true
                    }, {
                        label: 'Actual',
                        data: [1150, 1380, 1750, null, null, null],
                        borderColor: 'rgba(255, 193, 7, 1)',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeTerritoryChart() {
            const ctx = document.getElementById('territoryChart');
            if (!ctx) return;

            analyticsCharts.territory = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['SMB Team', 'Mid-Market', 'Enterprise'],
                    datasets: [{
                        label: 'Pipeline Value ($K)',
                        data: [450, 890, 1200],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(111, 66, 193, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function startRealTimeMetrics() {
            setInterval(() => {
                updateLiveMetrics();
            }, 5000);
        }

        function updateLiveMetrics() {
            const conversionEl = document.getElementById('liveConversion');
            const scoreEl = document.getElementById('avgScoreLive');
            const responseEl = document.getElementById('responseTime');
            const qualifiedEl = document.getElementById('qualifiedLeadsLive');
            
            if (conversionEl) {
                const baseConversion = 18.3;
                const variation = (Math.random() - 0.5) * 0.4;
                conversionEl.textContent = (baseConversion + variation).toFixed(1) + '%';
            }
            
            if (scoreEl) {
                const baseScore = 73.2;
                const variation = (Math.random() - 0.5) * 2;
                scoreEl.textContent = (baseScore + variation).toFixed(1);
            }
            
            if (responseEl) {
                const baseResponse = 1.3;
                const variation = (Math.random() - 0.5) * 0.2;
                responseEl.textContent = Math.max(0.8, baseResponse + variation).toFixed(1) + 's';
            }
            
            if (qualifiedEl) {
                const baseQualified = 42;
                const variation = (Math.random() - 0.5) * 2;
                qualifiedEl.textContent = Math.round(baseQualified + variation) + '%';
            }
        }

        function initializeTracking() {
            window.addEventListener('scroll', function() {
                const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
                behavioralData.scrollDepth = Math.max(behavioralData.scrollDepth, Math.round(scrollPercent));
            });

            const formInputs = document.querySelectorAll('#leadForm input, #leadForm select');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    behavioralData.formInteractions++;
                    trackEvent('form_interaction', input.name);
                });
            });

            setInterval(function() {
                behavioralData.timeOnPage = Math.round((Date.now() - pageStartTime) / 1000);
            }, 1000);
        }

        function trackEvent(action, category, value = null) {
            const event = {
                timestamp: new Date().toISOString(),
                action: action,
                category: category,
                value: value,
                sessionData: behavioralData
            };
            
            behavioralData.clickEvents.push(event);
            console.log('Event tracked:', event);
        }

        function loadExistingLeads() {
            const stored = localStorage.getItem('demoLeads');
            if (stored) {
                leads = JSON.parse(stored);
                updateGTMDashboard();
            }
        }

        function startIntentSignalMonitoring() {
            setInterval(() => {
                if (Math.random() > 0.95 && leads.length > 0) {
                    const randomLead = leads[Math.floor(Math.random() * leads.length)];
                    const signals = [
                        'Downloaded pricing guide',
                        'Visited competitor comparison page',
                        'Spent 5+ minutes on ROI calculator',
                        'Shared content on LinkedIn',
                        'Requested product demo from sales'
                    ];
                    const randomSignal = signals[Math.floor(Math.random() * signals.length)];
                    addIntentSignal(randomLead.company, randomSignal);
                }
            }, 2000);
        }

        function addIntentSignal(company, signal) {
            const signalElement = document.createElement('div');
            signalElement.innerHTML = `
                <strong>${company}:</strong> ${signal}
                <small style="color: #666; margin-left: 10px;">${new Date().toLocaleTimeString()}</small>
            `;
            signalElement.style.marginBottom = '10px';
            signalElement.style.padding = '8px';
            signalElement.style.background = '#fff3cd';
            signalElement.style.borderRadius = '5px';
            signalElement.style.borderLeft = '3px solid #ffc107';
            
            const container = document.getElementById('intentSignalsList');
            container.insertBefore(signalElement, container.firstChild);
        }

        function initializeMLScorer() {
    console.log('ML Scorer initialized');
}

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('successModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        // Add the new function here
        async function loadLiveActivity() {
            try {
                const response = await fetch('https://autonomous-agent-production.up.railway.app/api/status');
                const data = await response.json();
                
                const feed = document.getElementById('liveActivityFeed');
                
                if (data.recent_logs && data.recent_logs.length > 0) {
                    feed.innerHTML = data.recent_logs.slice(0, 8).map(log => `
                        <div style="padding: 10px; margin-bottom: 8px; background: white; border-radius: 5px; border-left: 3px solid ${log.type === 'ERROR' ? '#dc3545' : '#667eea'};">
                            <small style="color: #999;">${new Date(log.timestamp).toLocaleString()}</small>
                            <div style="margin-top: 4px;"><strong>${log.type}:</strong> ${log.message}</div>
                        </div>
                    `).join('');
                } else {
                    feed.innerHTML = '<p style="text-align: center; color: #999;">No recent activity</p>';
                }
            } catch (err) {
                console.error('Failed to load activity:', err);
                document.getElementById('liveActivityFeed').innerHTML = '<p style="text-align: center; color: #dc3545;">Failed to load activity feed</p>';
            }
        }
        
        // Load immediately and refresh every 10 seconds
        loadLiveActivity();
        setInterval(loadLiveActivity, 10000);
    </script>
</body>
</html>





